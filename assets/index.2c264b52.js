import{c as f,u as E,g as S,h as b,o as T,i as L,j as C,s as p,k as O}from"./index.b0bc66d4.js";import{H as B,K as d,N as k,y as g,G as N,Q as x,v as j,U as I,x as _,D as w}from"./vendor.01b03999.js";/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const y=Symbol("anchorToken");/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const H={affix:f.bool.def(!0),bounds:f.number,hideLinkBall:f.bool,offsetTop:f.number,target:f.oneOfType([String,HTMLElement]),targetOffset:f.number,onChange:f.emit(),onClick:f.emit()},R={href:f.string.isRequired,title:f.string};var G=B({name:"IxAnchor",props:H,setup(n,{slots:l}){const a=E("anchor"),o=d(()=>{var e;return(e=n.hideLinkBall)!=null?e:a.hideLinkBall}),u=d(()=>{const{offsetTop:e}=n;return{maxHeight:e?`calc(100vh - ${e}px)`:"100vh"}}),{activeLink:t}=M(n,a),{anchorRef:i,inkBallClasses:r,inkBallTop:h}=$(t);return()=>{var e;const s=o.value?null:k("span",{class:r.value,style:{top:h.value}},null),c=k("div",{class:"ix-anchor-wrapper",style:u.value},[k("div",{class:"ix-anchor",ref:i},[k("div",{class:"ix-anchor-ink"},[s]),(e=l.default)==null?void 0:e.call(l)])]);return n.affix?k(S,{target:n.target,offset:n.offsetTop},{default:()=>[c]}):c}}});const M=(n,l)=>{const a=g([]),o=e=>{a.value.includes(e)||a.value.push(e)},u=e=>{const s=a.value.indexOf(e);s!==-1&&a.value.splice(s,1)},t=g(),i=e=>{t.value!==e&&(t.value=e,C(n.onChange,e))},{scrollTo:r}=P(n,l,a,i);return N(y,{registerLink:o,unregisterLink:u,activeLink:t,handleLinkClick:(e,s)=>{C(n.onClick,e,s),r(s.href)}}),{activeLink:t}},$=n=>{const l=g(),a=d(()=>({"ix-anchor-ink-ball":!0,"ix-anchor-ink-ball-visible":!!n.value})),o=g();return x(()=>{j(()=>{var u;const t=(u=l.value)==null?void 0:u.querySelector(`a[data-href="${n.value}"]`);if(!t)return;const{offsetTop:i,clientHeight:r}=t;o.value=`${i+r/2-4.5}px`})}),{anchorRef:l,inkBallClasses:a,inkBallTop:o}},A=(n,l)=>{const a=document.getElementById(n.split("#")[1]);if(a){const{top:o}=O(a,l);return o}return null},q=(n,l,a,o)=>n.reduce((t,i)=>{const r=A(i,l);return r!==null&&r<a+o&&t.top<r?{link:i,top:r}:t},{link:"",top:Number.MIN_SAFE_INTEGER}).link,P=(n,l,a,o)=>{const u=d(()=>{var c;return(c=n.bounds)!=null?c:l.bounds}),t=g(),i="scroll";let r=!1;const h=d(()=>{var c,v;return(v=(c=n.targetOffset)!=null?c:n.offsetTop)!=null?v:0}),e=()=>{if(r)return;const c=q(a.value,t.value,h.value,u.value);o(c)},s=c=>{o(c);const v=A(c,t.value);v!==null&&(r=!0,p({amountOfChange:v-h.value,target:t.value,callback:()=>{r=!1}}))};return I(()=>n.target,()=>{L(t.value,i,e),t.value=b(n.target),T(t.value,i,e),e()}),x(()=>{t.value=b(n.target),T(t.value,i,e),e()}),_(()=>{L(t.value,i,e)}),{scrollTo:s}};var U=B({name:"IxAnchorLink",props:R,setup(n,{slots:l}){const{registerLink:a,unregisterLink:o,activeLink:u,handleLinkClick:t}=w(y);I(()=>n.href,(e,s)=>{o(s),a(e)}),x(()=>a(n.href)),_(()=>o(n.href));const i=d(()=>u.value===n.href),r=d(()=>({"ix-anchor-link-title":!0,"ix-anchor-link-title-active":i.value})),h=e=>t(e,n);return()=>{var e,s,c;const{href:v,title:m}=n;return k("div",{class:"ix-anchor-link"},[k("a",{class:r.value,href:v,"data-href":v,title:m,onClick:h},[(s=(e=l.title)==null?void 0:e.call(l))!=null?s:m]),(c=l.default)==null?void 0:c.call(l)])}}});/**
 * @license
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://github.com/IDuxFE/idux/blob/main/LICENSE
 */const K=G,Q=U;export{K as I,Q as a};
